<div align="center">

<a id="readme-top"></a>

<br>

<img alt="MoJ logo" src="https://moj-logos.s3.eu-west-2.amazonaws.com/moj-uk-logo.png" width="200">

# Help With Child Arrangements

[![repo standards badge](https://img.shields.io/endpoint?labelColor=231f20&color=005ea5&style=for-the-badge&url=https%3A%2F%2Foperations-engineering-reports.cloud-platform.service.justice.gov.uk%2Fapi%2Fv1%2Fcompliant_public_repositories%2Fendpoint%2Fhelp-with-child-arrangements&logo=data:image/png;base64,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)](https://operations-engineering-reports.cloud-platform.service.justice.gov.uk/public-report/help-with-child-arrangements)
[![License](https://img.shields.io/github/license/ministryofjustice/help-with-child-arrangements?style=for-the-badge)](https://github.com/ministryofjustice/help-with-child-arrangements/blob/main/LICENCE.md)

[![CI and CD](https://github.com/ministryofjustice/help-with-child-arrangements/actions/workflows/cd.yaml/badge.svg)](https://github.com/ministryofjustice/help-with-child-arrangements/actions/workflows/cd.yaml)

</div>

Private Family Law - Child Arrangements Information Tool

## Development

### Working on the Code

Work should be based off of, and PRed to, the main branch. We use the GitHub
PR approval process so once your PR is ready you'll need to have one person
approve it, and the CI tests passing, before it can be merged.

### Basic Setup

#### Cloning This Repository

Clone this repository then `cd` into the new directory

```
$ git clone git@github.com:ministryofjustice/help-with-child-arrangements.git
$ cd help-with-child-arrangements
```

### Installing the app for development

##### Latest Version of Ruby

If you don't have `rbenv` already installed, install it as follows:
```
$ brew install rbenv ruby-build
```

Use `rbenv` to install the latest version of ruby as defined in `.ruby-version` (make sure you are in the repo path):

```
$ rbenv install
$ rbenv init
$ rbenv rehash
```

Follow the instructions printed out from the `rbenv init` command and update your `~/.bash_profile` or equivalent file accordingly, then start a new terminal and navigate to the repo directory.

#### Database Setup
The application uses postgresql
```
$ brew install postgresql
```

Use the setup command to install gems and create the database with seed data
```
$ bin/setup
```

#### Assets
Yarn and node are required to build css and js assets
```
$ brew install node
$ brew install yarn
```

#### Running locally
Use the dev command to run the application
```
$ bin/dev
```

If this dev command fails with the message "foreman: not found" install the foreman gem manually:
```
$ gem install foreman
```
Then append `export PATH="~/.gem/bin:$PATH"` to your `~/.bash_profile` or equivalent file accordingly, then start a new terminal and navigate to the repo directory.

Equally, if the dev command fails with the message "terminated by SIGTERM" and the build output also states "/bin/sh: esbuild: command not found" run the commands:
```
$ yarn add esbuild
```
```
$ yarn add sass
```

## Development with Docker

##### Installing Docker & Dory

This project uses Docker and the [Dory proxy](https://github.com/FreedomBen/dory) to keep your development environment
ephemeral. Dory ensures your http://localhost/ is free for use by other applications.

###### Macbook

https://docs.docker.com/desktop/install/mac-install/

###### Linux

https://docs.docker.com/desktop/install/linux-install/

##### Launch the site locally

```bash
dory up
```

```bash
docker compose up
```

##### What happens next?

1. Docker builds the required images
2. Ruby, Rails and PostgresDB are installed in networked containers
3. An init script runs
4. Rails launches with a setup script
5. The Database is created
6. Migrations are loaded including any seed data
7. CSS and JS watchers are launched (in the background)
8. Puma server is started on port 3000
9. The site becomes available at: http://help-with-child-arrangements.docker/

Updates you make to source code will be available to view in your
browser, [at the above URL](http://help-with-child-arrangements.docker/). Output and errors during development can be
viewed in the terminal output.

##### Finishing your development session

```bash
docker compose down
```

To start again, simply run:

```bash
docker compose up
```

### Access a running container

From time to time it may be necessary to use commands like `rails c`. Because the application is running inside a
container you will need to access this container to execute operations.

```bash
docker compose exec --workdir /app app sh
```

From the command prompt, run `rails c` and other commands to assist development.

### Testing

TODO **_: create a spec environment_**.

This project provides an ephemeral, pre-production environment to develop locally. Rspec tests are configured and
executed using the CI environment, via GitHub Actions.

It is possible to run tests via `docker compose exec`. Please be sure to update both the `RAILS_ENV` and `DATABASE_URL`
environment.

```bash
RAILS_ENV=test
DATABASE_URL=postgres://postgres@db/child_arrangements_test
```
